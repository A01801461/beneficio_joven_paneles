<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Usuarios</title>
  <link rel="stylesheet" href="styles/sideBar.css" />
  <link rel="stylesheet" href="styles/users.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
  <link rel="shortcut icon" href="images/iconoWeb.png" />
  <style>
    .filtro-container {
      display: flex;
      justify-content: flex-end;
      margin: 15px 30px;
    }
    select {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      cursor: pointer;
    }
    table {
      width: 90%;
      margin: auto;
      border-collapse: collapse;
      text-align: center;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }
    th {
      background-color: #f5f5f5;
    }
  </style>
</head>

<body>
  <div class="main-container">
    <div class="side-bar">
      <div class="logo-container">
        <img
          src="images/logoSinFondo.png"
          alt="logo Beneficio Joven"
          class="logo"
        />
        <p class="titulo"><strong>BENEFICIO</strong> JOVEN</p>
        <p class="titulo">Administradores</p>
      </div>
      <div class="botones-side">
        <a class="side-btn" href="statsAdmins.html">
          <i class="fas fa-chart-line"></i> estad칤sticas
        </a>
        <a class="selected-side-btn" href="usersAdmins.html">
          <i class="fas fa-users"></i> usuarios
        </a>
        <a class="side-btn" href="cuponsAdmins.html">
          <i class="fas fa-ticket-alt"></i> cupones
        </a>
        <a class="side-btn" href="ayudaAdmins.html">
          <i class="fas fa-question-circle"></i> ayuda
        </a>
        <a class="side-btn" href="index.html">
          <i class="fas fa-sign-out-alt"></i> salir
        </a>
      </div>
    </div>

    <div class="contenido-pagina">
      <h2>Administrar Usuarios</h2>

      <!-- 游댷 Selector de filtro -->
      <div class="filtro-container">
        <select id="filtro-usuarios">
          <option value="all">Todos los usuarios</option>
          <option value="jovenes">J칩venes</option>
          <option value="merchants">Comercios</option>
          <option value="admins">Administradores</option>
        </select>
      </div>

      <!-- 游댷 Tabla -->
      <div class="contenedor-tabla">
        <table>
          <thead>
            <tr id="encabezadoTabla">
              <th>ID</th>
              <th>Email</th>
              <th>Rol</th>
              <th>Fecha de creaci칩n</th>
            </tr>
          </thead>
          <tbody id="tablaUsuarios">
            <tr><td colspan="4">Cargando usuarios...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const tablaUsuarios = document.getElementById("tablaUsuarios");
    const encabezadoTabla = document.getElementById("encabezadoTabla");
    const filtroSelect = document.getElementById("filtro-usuarios");

    async function cargarUsuarios(tipo = "all") {
      let url;
      switch (tipo) {
        case "jovenes":
          url = "http://localhost:4000/beneficioJoven/jovenes";
          break;
        case "merchants":
          url = "http://localhost:4000/beneficioJoven/merchants";
          break;
        case "admins":
          url = "http://localhost:4000/beneficioJoven/admins";
          break;
        default:
          url = "http://localhost:4000/beneficioJoven/allusers";
      }

      tablaUsuarios.innerHTML = "<tr><td colspan='4'>Cargando usuarios...</td></tr>";

      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Error al obtener datos");
        const data = await response.json();

        // Limpia encabezados anteriores
        encabezadoTabla.innerHTML = "";

        // Ajusta columnas seg칰n el tipo
        let columnas = [];
        if (tipo === "all") {
          columnas = ["ID", "Email", "Rol", "Fecha de creaci칩n"];
        } else if (tipo === "jovenes") {
          columnas = ["ID", "Nombre Completo", "CURP", "D칤a de nacimiento", "Municipio"];
        } else if (tipo === "merchants") {
          columnas = ["ID", "Nombre del comercio", "Descripcion", "Logo", "Tipo de comercio"];
        } else if (tipo === "admins") {
          columnas = ["ID", "Nombre", "Nivel de acceso"];
        }

        // Crea encabezados din치micamente
        columnas.forEach(col => {
          const th = document.createElement("th");
          th.textContent = col;
          encabezadoTabla.appendChild(th);
        });

        // Llena filas seg칰n el tipo
        if (data.length === 0) {
          tablaUsuarios.innerHTML = `<tr><td colspan="${columnas.length}">No hay datos</td></tr>`;
          return;
        }

        tablaUsuarios.innerHTML = data.map(u => {
          if (tipo === "all") {
            return `
              <tr>
                <td>${u.id}</td>
                <td>${u.email}</td>
                <td>${u.role}</td>
                <td>${u.password}</td>
                <td>${new Date(u.created_at).toLocaleString()}</td>
              </tr>`;
          } else if (tipo === "jovenes") {
            return `
              <tr>
                <td>${u.user_id}</td>
                <td>${u.full_name || u.name || "-"}</td>
                <td>${u.curp || "-"}</td>
                <td>${u.birth_date || u.email || "-"}</td>
                <td>${u.municipality || "-"}</td>
              </tr>`;
          } else if (tipo === "merchants") {
            return `
              <tr>
                <td>${u.user_id}</td>
                <td>${u.merchant_name}</td>
                <td>${u.description}</td>
                <td>${u.logo_url}</td>
                <td>${u.merchant_type}</td>
              </tr>`;
          } else if (tipo === "admins") {
            return `
              <tr>
                <td>${u.user_id}</td>
                <td>${u.full_name}</td>
                <td>${u.is_super_admin}</td>
              </tr>`;
          }
        }).join("");
      } catch (error) {
        console.error(error);
        tablaUsuarios.innerHTML = "<tr><td colspan='4'>Error al cargar datos</td></tr>";
      }
    }

    filtroSelect.addEventListener("change", (e) => {
      cargarUsuarios(e.target.value);
    });

    cargarUsuarios();
  </script>
</body>
</html>